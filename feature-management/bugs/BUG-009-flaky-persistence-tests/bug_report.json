{
  "bug_id": "BUG-009",
  "title": "Flaky persistence/recovery tests due to test isolation issues",
  "component": "ccmux-server",
  "severity": "medium",
  "priority": "P2",
  "status": "new",
  "reported_date": "2026-01-09",
  "updated_date": "2026-01-09",
  "assigned_to": null,
  "tags": ["testing", "persistence", "race-condition", "crash-recovery"],
  "affected_versions": ["0.1.0"],
  "environment": "Test environment (cargo test)",
  "reproducibility": "sometimes",
  "description": "The persistence/recovery tests in ccmux-server have intermittent race conditions. A different test fails on each run - it's not one specific test but rather test isolation issues affecting the entire persistence test suite. Tests pass when run individually but fail approximately 30% of the time when run in parallel with the full workspace.",
  "steps_to_reproduce": [
    "Run cargo test --workspace multiple times",
    "Observe intermittent failures in persistence tests",
    "Note that the failing test is different each time",
    "Run the failing test in isolation - it passes",
    "Repeat cargo test --workspace - different test fails"
  ],
  "expected_behavior": "All persistence tests should pass reliably 100% of the time when run in parallel as part of the full test suite",
  "actual_behavior": "Approximately 30% of test runs fail with 1 test failure. The failing test varies between: test_recovery_from_wal, test_recovery_active_window_pane, test_recovery_pane_updates, test_persistence_log_operations",
  "evidence": [
    {
      "type": "file",
      "location": "ccmux-server/src/persistence/recovery.rs",
      "description": "Contains test_recovery_from_wal, test_recovery_active_window_pane, test_recovery_pane_updates"
    },
    {
      "type": "file",
      "location": "ccmux-server/src/persistence/mod.rs",
      "description": "Contains test_persistence_log_operations"
    },
    {
      "type": "output",
      "location": "inline",
      "description": "Tests pass individually but fail ~30% of parallel runs"
    }
  ],
  "root_cause": "Suspected: Tests share temp directories or file handles, lack proper test isolation. Possible issues include shared hardcoded paths, missing cleanup in test teardown, file handles not properly closed, timing assumptions, or shared mutable state between tests.",
  "impact": "CI/test noise makes it difficult to verify if new features are working correctly. Has been plaguing the project for multiple sessions."
}
