{
  "bug_id": "BUG-052",
  "title": "Agents inside fugue panes cannot connect to fugue MCP server",
  "component": "mcp-bridge",
  "severity": "high",
  "priority": "P1",
  "status": "resolved",
  "reported_date": "2026-01-17",
  "updated_date": "2026-01-17",
  "resolution": "Issue no longer reproduces - Gemini CLI inside fugue pane successfully connects to fugue MCP server and executes tools. Likely fixed by earlier MCP bridge improvements.",
  "assigned_to": null,
  "tags": ["orchestration", "mcp-bridge", "pty", "bug"],
  "affected_versions": [],
  "environment": "development",
  "reproducibility": "always",
  "description": "When an AI agent (e.g., Gemini CLI) is launched inside a fugue pane, it cannot connect to the fugue MCP server. This breaks the core orchestration use case where agents inside fugue should be able to control fugue (create panes, split windows, orchestrate other agents, etc.).",
  "steps_to_reproduce": [
    "Start fugue with MCP bridge running",
    "Have an outer agent (Claude Code) connected to fugue MCP successfully",
    "Use fugue MCP to create a session and pane",
    "Launch Gemini CLI (or another agent with fugue MCP configured) inside the pane",
    "Observe Gemini fails to connect to fugue MCP server"
  ],
  "expected_behavior": "Agents running inside fugue panes should be able to connect to the fugue MCP server and use fugue tools to orchestrate (create panes, send input, read output, etc.). This is the core multi-agent orchestration use case.",
  "actual_behavior": "The nested agent fails to connect with error: 'MCP ERROR (fugue) Error during discovery for MCP server fugue: Client is not connected, must connect before interacting with the server. Current state is disconnected'",
  "evidence": {
    "error_message": "MCP ERROR (fugue) Error during discovery for MCP server 'fugue': Client is not connected, must connect before interacting with the server. Current state is disconnected",
    "context": "Gemini CLI launched inside fugue pane"
  },
  "root_cause": "Suspected causes: (1) MCP bridge socket path not accessible from PTY environment, (2) MCP bridge only allows single client connection (stdio-based), (3) Configuration path issues - agent inside pane can't find MCP config, (4) Bridge architecture doesn't support multiple concurrent clients",
  "impact": "Critical - this breaks the primary orchestration use case where agents coordinate through fugue. Multi-agent workflows requiring agents to spawn and orchestrate other agents via fugue are completely blocked."
}
