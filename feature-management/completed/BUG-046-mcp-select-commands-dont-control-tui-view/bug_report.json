{
  "bug_id": "BUG-046",
  "title": "MCP select_session/select_window commands don't control TUI view",
  "component": "handlers/session",
  "severity": "medium",
  "priority": "P2",
  "status": "new",
  "reported_date": "2026-01-16",
  "updated_date": "2026-01-16",
  "assigned_to": null,
  "tags": ["mcp", "tui", "focus", "session-navigation", "FEAT-078", "FEAT-079"],
  "affected_versions": [],
  "environment": "Linux (WSL2) - MCP bridge + TUI integration",
  "reproducibility": "always",
  "description": "MCP select_session and select_window commands return success but don't change the TUI view. The MCP bridge and TUI are separate clients with independent focus states (FEAT-078), so MCP commands only update the MCP bridge's internal focus, not the human's visible TUI.",
  "steps_to_reproduce": [
    "Start ccmux with TUI attached to a session",
    "Create additional sessions via MCP: ccmux_create_session(name: 'test')",
    "Call ccmux_select_session(session_id: '<new-session-id>')",
    "Observe: MCP returns success, but TUI still shows original session",
    "Manually switch sessions in TUI to verify sessions exist"
  ],
  "expected_behavior": "When MCP calls select_session or select_window, the attached TUI's view should change to that session/window, matching what a human would see if they used keyboard shortcuts",
  "actual_behavior": "MCP command returns success. TUI view unchanged. Human must manually switch sessions/windows despite MCP 'success' response.",
  "evidence": {
    "affected_tools": [
      "ccmux_select_session",
      "ccmux_select_window"
    ],
    "affected_files": [
      "ccmux-server/src/handlers/session.rs",
      "ccmux-server/src/registry.rs"
    ],
    "related_features": [
      "FEAT-078 (per-client focus state)",
      "FEAT-079 (client type tracking)"
    ]
  },
  "root_cause": "Per-client focus architecture (FEAT-078) isolates focus state. handle_select_session() calls registry.update_client_focus(self.client_id, ...) which updates the MCP bridge client's focus, not the TUI client's focus. MCP bridge and TUI have separate ClientIds and independent ClientFocusState structs.",
  "impact": "MCP select commands appear to work but have no visible effect. Breaks QA demo expectations. Users must manually navigate despite agent 'successfully' switching sessions. Undermines the value of MCP-based orchestration."
}
