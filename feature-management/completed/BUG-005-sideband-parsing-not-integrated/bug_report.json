{
  "bug_id": "BUG-005",
  "title": "Sideband parsing not integrated into PTY output flow",
  "component": "fugue-server",
  "severity": "high",
  "priority": "P1",
  "status": "new",
  "reported_date": "2026-01-09",
  "updated_date": "2026-01-09",
  "assigned_to": null,
  "tags": ["sideband", "pty", "integration", "claude-communication"],
  "affected_versions": ["0.1.0"],
  "environment": "All platforms",
  "reproducibility": "always",
  "description": "Sideband commands (<fugue:spawn>, <fugue:focus>, etc.) output by Claude are displayed as literal text instead of being parsed and executed. The sideband parsing infrastructure exists but is not wired into the PTY output flow.",
  "steps_to_reproduce": [
    "Start fugue server and client",
    "Create a session and attach",
    "Have Claude (or manually echo) output: <fugue:spawn direction=\"vertical\" />",
    "Observe that the XML tag is displayed as literal text in the terminal",
    "No new pane is created"
  ],
  "expected_behavior": "XML sideband commands should be: (1) parsed by SidebandParser, (2) stripped from terminal display output, (3) executed by CommandExecutor to create panes, send input, etc.",
  "actual_behavior": "XML sideband commands are passed through to the terminal display as literal text. SidebandParser and CommandExecutor exist but are only instantiated in tests.",
  "evidence": [
    {
      "type": "file",
      "location": "fugue-server/src/pty/output.rs:389-394",
      "description": "PtyOutputPoller::flush() broadcasts raw PTY output without parsing"
    },
    {
      "type": "file",
      "location": "fugue-server/src/sideband/mod.rs:63-72",
      "description": "CommandExecutor is only instantiated in test code"
    },
    {
      "type": "file",
      "location": "fugue-server/src/sideband/mod.rs:36-42",
      "description": "Processing pipeline diagram shows intended flow that isn't implemented"
    },
    {
      "type": "file",
      "location": "fugue-server/src/main.rs",
      "description": "No code instantiates CommandExecutor or SidebandParser in server runtime"
    }
  ],
  "root_cause": "FEAT-019 (sideband parser) and FEAT-030 (spawn command executor) were marked as complete, but the integration point - wiring the parser/executor into PtyOutputPoller - was never implemented. The parser and executor exist as standalone modules that are only exercised by unit tests.",
  "impact": "Claude cannot control fugue via sideband commands. The core value proposition of Claude-fugue integration (autonomous pane spawning, input routing, notifications) is non-functional."
}
