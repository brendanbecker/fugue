{
  "bug_id": "BUG-039",
  "title": "MCP tools hang intermittently through Claude Code",
  "component": "mcp-bridge",
  "severity": "high",
  "priority": "P1",
  "status": "new",
  "reported_date": "2026-01-11",
  "updated_date": "2026-01-13",
  "assigned_to": null,
  "tags": ["mcp", "claude-code", "connection-management", "hang", "orphan-processes"],
  "affected_versions": [],
  "environment": "Linux (WSL2) - Claude Code MCP integration",
  "reproducibility": "sometimes",
  "description": "MCP tool calls (list_sessions, create_window, list_windows, etc.) frequently hang when called through Claude Code's MCP integration, requiring manual abort. However, the exact same operations work reliably when calling the mcp-bridge directly via bash.",
  "steps_to_reproduce": [
    "Configure ccmux MCP server in Claude Code settings",
    "Start ccmux daemon (ccmux-server start)",
    "Use Claude Code to invoke MCP tools like ccmux_list_sessions",
    "Observe intermittent hangs requiring manual abort",
    "Check for orphaned mcp-bridge processes with 'ps aux | grep mcp-bridge'"
  ],
  "expected_behavior": "MCP tool calls through Claude Code should complete reliably within a reasonable timeout, matching the behavior of direct bash invocation",
  "actual_behavior": "MCP tool calls frequently hang indefinitely with no automatic timeout. Tested waiting several minutes with no change - hang appears permanent until manually aborted. Multiple stale mcp-bridge processes (10+) accumulate. Direct bash invocation works every time.",
  "evidence": {
    "observation": "Multiple stale mcp-bridge processes accumulate (seen 10+ orphaned processes)",
    "timeout_behavior": "No automatic timeout observed. Hangs persist for several minutes (not tested to completion). Manual abort (ctrl+c) required - produces 'AbortError: The operation was aborted'",
    "daemon_status": "Running and responsive via direct invocation",
    "socket_location": "/run/user/1000/ccmux/ccmux.sock",
    "working_command": "echo '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/call\",\"params\":{\"name\":\"ccmux_list_sessions\",\"arguments\":{}}}' | timeout 3 ccmux-server mcp-bridge"
  },
  "root_cause": "Suspected: Something about persistent MCP connections or connection pooling in Claude Code's MCP client may be causing issues. Possibly stale connections not being cleaned up properly, or mcp-bridge processes not exiting cleanly when Claude Code's connection closes.",
  "impact": "Significantly impacts usability of ccmux through Claude Code. Users must frequently abort hanging tool calls and manually clean up orphaned processes. Breaks the primary use case of AI-assisted terminal management."
}
